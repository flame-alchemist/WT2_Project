<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Login</title>
        <link rel="stylesheet" href="signup.css">
        <link rel="stylesheet" href="../navbar/nav.css">
    </head>
    <body class="bg">
        <script>
            function requestsend()
            {
                var form = new FormData(document.getElementById('form'));
                var obj = {"email":form.get("emailID"), "password":form.get("password")};

                var JSONdata = JSON.stringify(obj);
                console.log(JSONdata);
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "http://0.0.0.0:8080/api/v1/check_user", true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.onreadystatechange = function(){
                    if (xhr.status === 201) //&& xhr.readyState === 4)
                    {
                        var obj = JSON.parse(this.responseText);
                        sessionStorage.setItem("username",obj["name"]);
                        sessionStorage.setItem("id",obj["id"]);
                        alert("User logged in");
                        window.location.href = "home2.html";
                    }
                    else
                        alert("User exists");
                };
                xhr.send(JSONdata);
                alert("Processing");
            }
        </script>

        <!--Navigation bar-->
        <div class="topnav">
                <a href="../home_page/home.html">Home</a>
                <a href="../book_page/cart.html">Cart</a>
                <a href="../login_signup/signup.html">Signup</a>
                <a href="../login_signup/login.html">Login</a>

        </div>
        <!--end of Navigation bar-->

        <div id = "box">
                <center><h1 class = "header" >Login</h1></center>
                <br>
            <form id='form'  onsubmit="requestsend()" method="POST" class="form">
                <b>Email</b><input type="email" name="emailID" class="tbox">
                <br>
                <b>Password</b><input type="password" name="password" minlength="5" class="tbox">
                <br>
                <center><input type="submit" value="Login" class="sub"></center>
            </form>
        </div>

    </body>
</html>
